{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/addons/gamepad/style.css","webpack:///./src/addons/gamepad/active.png","webpack:///./src/addons/gamepad/close.svg","webpack:///./src/addons/gamepad/cursor.png","webpack:///./src/addons/gamepad/dot.svg","webpack:///./src/addons/gamepad/gamepadlib.js","webpack:///./src/addons/gamepad/index.js","webpack:///./src/addons/gamepad/userscript.js","webpack:///./src/addons/index.js","webpack:///./src/addons/pause.js","webpack:///./src/addons/pointerlock.js","webpack:///./src/addons/special-cloud-behaviors.js","webpack:///./src/addons/unsafe-cloud-behaviors.js","webpack:///./src/common/event-target.js"],"names":["console","window","defaultAxesMappings","arrows","type","high","low","deadZone","wasd","cursor","sensitivity","emptyMapping","transformAndCopyMapping","mapping","warn","copy","Object","assign","button","prepareMappingForExport","prepareAxisMappingForExport","prepareButtonMappingForExport","padWithEmptyMappings","array","length","push","createEmptyMappingList","getMovementConfiguration","usedKeys","usesArrows","has","usesWASD","getGamepadId","gamepad","concat","id","index","GamepadData","constructor","gamepadLib","resetMappings","hints","getHints","buttonMappings","getDefaultButtonMappings","map","axesMappings","getDefaultAxisMappings","clearMappings","buttons","axes","importedSettings","alreadyUsedKeys","Set","add","possiblePauseKeys","possibleActionKeys","Array","from","filter","i","includes","findKey","keys","key","getPrimaryAction","getSecondaryAction","getPauseKey","getUp","getDown","getRight","getLeft","action1","action2","action3","action4","defaultHints","generated","GamepadLib","EventTarget","gamepads","Map","handleConnect","bind","handleDisconnect","update","animationFrame","currentTime","deltaTime","virtualCursor","x","y","maxX","Infinity","minX","maxY","minY","modified","_editor","connectCallbacks","keysPressedThisFrame","oldKeysPressed","mouseButtonsPressedThisFrame","oldMouseDown","addEventHandlers","addEventListener","removeEventHandlers","removeEventListener","gamepadConnected","size","Promise","resolve","getUserHints","resetControls","values","clearControls","e","callback","log","gamepadData","set","requestAnimationFrame","dispatchEvent","CustomEvent","detail","get","delete","cancelAnimationFrame","dispatchKey","pressed","dispatchMouse","down","dispatchMouseMove","updateButton","value","isDown","Math","abs","action","multiplier","speed","time","oldMouseButtonsPressed","max","min","navigator","getGamepads","data","axis","browserHasBrokenGamepadAPI","userAgent","setConsole","n","addStylesheet","css","stylesheet","document","createElement","textContent","head","appendChild","run","_ref","scaffolding","options","gamepadUserscript","pointerlock","gamepadUserstyle","_sidekickGetAsset","path","_sidekickAsset0","_sidekickAsset1","_sidekickAsset2","_sidekickAsset3","Error","vm","editingTarget","runtime","once","vmStarted","_steppingInterval","scratchKeyToKey","toLowerCase","charAt","getKeysUsedByProject","allBlocks","getTargetForStage","targets","isOriginal","blocks","result","block","_blocks","opcode","parent","fields","KEY_OPTION","GAMEPAD_CONFIG_MAGIC","findOptionsComment","target","comments","comment","text","parseOptionsComment","lineWithMagic","split","find","endsWith","jsonText","substr","parsed","JSON","parse","isArray","parsedOptions","renderer","width","_xRight","_xLeft","height","_yTop","_yBottom","canvas","virtualCursorElement","hidden","className","src","hideCursorTimeout","hideRealCursor","body","classList","showRealCursor","remove","virtualCursorSetVisible","visible","clearTimeout","setTimeout","virtualCursorHide","virtualCursorSetDown","toggle","virtualCursorSetPosition","CURSOR_SIZE","stageX","stageY","style","transform","getCanvasSize","ResizeObserver","canvasWidth","canvasHeight","resizeObserver","entries","entry","contentRect","observe","rect","getBoundingClientRect","virtualX","virtualY","postMouseData","rectWidth","rectHeight","postIOData","_objectSpread","postKeyboardData","handleGamepadButtonDown","handleGamepadButtonUp","handleGamepadMouseDown","handleGamepadMouseUp","handleGamepadMouseMove","deltaX","deltaY","SPEED_MULTIPLIER","zoomMultiplierX","layersRect","stageWidth","zoomMultiplierY","stageHeight","pointerLockMove","_overlays","api","specialCloudBehaviors","unsafeCloudBehaviors","pause","ScaffoldingAddons","STATUS_PROMISE_WAIT","STATUS_DONE","paused","pausedThreadState","WeakMap","audioContextStateChange","setPaused","_paused","then","audioEngine","audioContext","suspend","ioDevices","clock","thread","threads","updateMonitor","pauseState","pauseTime","currentMSecs","status","emit","resume","now","Date","stackFrame","peekStackFrame","executionContext","timer","dt","startTime","ensurePausedThreadIsStillPaused","originalStepThreads","sequencer","stepThreads","call","originalGreenFlag","greenFlag","originalStartHats","startHats","_len","arguments","args","_key","apply","originalGetMonitorThreadCount","_getMonitorThreadCount","count","_canvas","mouse","isLocked","movementX","movementY","_clientX","_clientY","_scratchX","_scratchY","contains","stopPropagation","requestPointerLock","pointerLockElement","error","oldStep","_step","ret","SAFE_PROTOCOLS","isSafeURL","url","u","URL","location","href","protocol","shouldAlwaysOpenInNewTab","shouldAlwaysOpenInCurrentTab","openInNewTab","open","openInCurrentTab","SpecialCloudBehaviorsProvider","enable","manager","setVariable","clipboardData","getData","webSocketProvider","providers","setProjectId","initialProjectId","projectId","handleUpdateVariable","name","setUsername","clipboard","writeText","newId","provider","addCloudProvider","addCloudProviderOverride","isPromise","v","jsValueToScratchValue","UnsafeCloudBehaviorsProvider","setEvalValue","setEvalError","evaluateAsync","js","eval","catch","EventTargetShim","_events","event","handler","handlers","fn","CustomEventShim"],"mappings":"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","file":"scaffolding/addons.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/addons/index.js\");\n","module.exports = \".sa-gamepad-container {\\r\\n  margin-right: 0.2rem;\\r\\n}\\r\\n\\r\\n.sa-gamepad-spacer {\\r\\n  display: flex;\\r\\n  width: 100%;\\r\\n  justify-content: flex-end;\\r\\n}\\r\\n\\r\\n.sa-gamepad-popup-outer {\\r\\n  /* above fullscreen */\\r\\n  z-index: 99999;\\r\\n}\\r\\n.sa-gamepad-popup {\\r\\n  box-sizing: border-box;\\r\\n  width: 700px;\\r\\n  max-height: min(800px, 85vh);\\r\\n  height: 100%;\\r\\n  max-width: 85%;\\r\\n  margin: 50px auto;\\r\\n  display: flex;\\r\\n  flex-direction: column;\\r\\n}\\r\\n.sa-gamepad-popup-content {\\r\\n  background-color: white;\\r\\n  padding: 1.5rem 2.25rem;\\r\\n  height: 100%;\\r\\n  overflow-y: auto;\\r\\n}\\r\\n\\r\\n.sa-gamepad-popup [class*=\\\"modal_header-item-title\\\"] {\\r\\n  margin: 0 -20rem 0 0;\\r\\n}\\r\\n\\r\\n.sa-gamepad-cursor {\\r\\n  position: absolute;\\r\\n  top: 0;\\r\\n  left: 0;\\r\\n  z-index: 9999;\\r\\n  user-select: none;\\r\\n  pointer-events: none;\\r\\n  will-change: transform;\\r\\n  image-rendering: optimizeSpeed;\\r\\n  image-rendering: crisp-edges;\\r\\n  image-rendering: pixelated;\\r\\n}\\r\\n.sa-gamepad-cursor-down {\\r\\n  filter: invert(100%);\\r\\n}\\r\\n\\r\\n.sa-gamepad-small .sa-gamepad-container[data-editor-mode=\\\"editor\\\"] {\\r\\n  display: none !important;\\r\\n}\\r\\n\\r\\n.sa-gamepad-hide-cursor {\\r\\n  cursor: none;\\r\\n}\\r\\n\\r\\n.sa-gamepad-browser-support-warning {\\r\\n  font-weight: bold;\\r\\n  margin-bottom: 10px;\\r\\n}\\r\\n\\r\\n.sa-gamepad-store-settings {\\r\\n  display: none;\\r\\n}\\r\\n.sa-gamepad-store-settings > input {\\r\\n  margin-right: 4px;\\r\\n}\\r\\n.sa-gamepad-has-controller .sa-gamepad-store-settings {\\r\\n  display: block;\\r\\n}\\r\\n\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAGCAIAAABvrngfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAAAgSURBVBhXY/z//z8DKmCC0kgAKsQIBhA2FlXEmMXAAAC+2gYLeDM0CAAAAABJRU5ErkJggg==\"","export default \"data:image/svg+xml;base64,PHN2ZyBkYXRhLW5hbWU9IkxheWVyIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDcuNDggNy40OCI+PHBhdGggZD0iTTMuNzQgNi40OFYxTTEgMy43NGg1LjQ4IiBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6MnB4Ii8+PC9zdmc+DQo=\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAGCAIAAABvrngfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAAAVSURBVBhXYyAF/AcDCJsJQpEKGBgAjmQF/WBrfi0AAAAASUVORK5CYII=\"","export default \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4IiBoZWlnaHQ9IjgiIHZpZXdCb3g9IjAgMCAyLjExNyAyLjExNyI+PGNpcmNsZSBjeD0iMS4wNTgiIGN5PSIxLjA1OCIgcj0iMS4wNTgiIGZpbGw9InJlZCIvPjwvc3ZnPg0K\"","import {EventTarget, CustomEvent} from '../../common/event-target';\r\n\r\nlet console = window.console;\r\n\r\n/*\r\nMapping types:\r\n\r\ntype: \"key\" maps a button to a keyboard key\r\nAll key names will be interpreted as a KeyboardEvent.key value (https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values)\r\nhigh: \"KeyName\" is the name of the key to dispatch when a button reads a HIGH value\r\nlow: \"KeyName\" is the name of the key to dispatch when a button reads a LOW value\r\ndeadZone: 0.5 controls the minimum value necessary to be read in either + or - to trigger either high or low\r\nThe high/low distinction is necessary for axes. Buttons will only use high\r\n\r\ntype: \"mousedown\" maps a button to control whether the mouse is down or not\r\ndeadZone: 0.5 controls the minimum value to trigger a mousedown\r\nbutton: 0, 1, 2, etc. controls which button to press\r\n\r\ntype: \"virtual_cursor\" maps a button to control the \"virtual cursor\"\r\ndeadZone: 0.5 again controls the minimum value to trigger a movement\r\nsensitivity: 10 controls the speed\r\nhigh: \"+y\"/\"-y\"/\"+x\"/\"-x\" defines what happens when an axis reads high\r\nlow: \"+y\"/\"-y\"/\"+x\"/\"-x\" defines what happens when an axis reads low\r\n+y increases y, -y decreases y, +x increases x, -x decreases x.\r\n*/\r\n\r\nconst defaultAxesMappings = {\r\n  arrows: [\r\n    {\r\n      type: \"key\",\r\n      high: \"ArrowRight\",\r\n      low: \"ArrowLeft\",\r\n      deadZone: 0.5,\r\n    },\r\n    {\r\n      type: \"key\",\r\n      high: \"ArrowDown\",\r\n      low: \"ArrowUp\",\r\n      deadZone: 0.5,\r\n    },\r\n  ],\r\n  wasd: [\r\n    {\r\n      type: \"key\",\r\n      high: \"d\",\r\n      low: \"a\",\r\n      deadZone: 0.5,\r\n    },\r\n    {\r\n      type: \"key\",\r\n      high: \"s\",\r\n      low: \"w\",\r\n      deadZone: 0.5,\r\n    },\r\n  ],\r\n  cursor: [\r\n    {\r\n      type: \"virtual_cursor\",\r\n      high: \"+x\",\r\n      low: \"-x\",\r\n      sensitivity: 0.6,\r\n      deadZone: 0.2,\r\n    },\r\n    {\r\n      type: \"virtual_cursor\",\r\n      high: \"-y\",\r\n      low: \"+y\",\r\n      sensitivity: 0.6,\r\n      deadZone: 0.2,\r\n    },\r\n  ],\r\n};\r\n\r\nconst emptyMapping = () => ({\r\n  type: \"key\",\r\n  high: null,\r\n  low: null,\r\n});\r\nconst transformAndCopyMapping = (mapping) => {\r\n  if (typeof mapping !== \"object\" || !mapping) {\r\n    console.warn(\"invalid mapping\", mapping);\r\n    return emptyMapping();\r\n  }\r\n  const copy = Object.assign({}, mapping);\r\n  if (copy.type === \"key\") {\r\n    if (typeof copy.deadZone === \"undefined\") {\r\n      copy.deadZone = 0.5;\r\n    }\r\n    if (typeof copy.high === \"undefined\") {\r\n      copy.high = \"\";\r\n    }\r\n    if (typeof copy.low === \"undefined\") {\r\n      copy.low = \"\";\r\n    }\r\n  } else if (copy.type === \"mousedown\") {\r\n    if (typeof copy.deadZone === \"undefined\") {\r\n      copy.deadZone = 0.5;\r\n    }\r\n    if (typeof copy.button === \"undefined\") {\r\n      copy.button = 0;\r\n    }\r\n  } else if (copy.type === \"virtual_cursor\") {\r\n    if (typeof copy.high === \"undefined\") {\r\n      copy.high = \"\";\r\n    }\r\n    if (typeof copy.low === \"undefined\") {\r\n      copy.low = \"\";\r\n    }\r\n    if (typeof copy.sensitivity === \"undefined\") {\r\n      copy.sensitivity = 10;\r\n    }\r\n    if (typeof copy.deadZone === \"undefined\") {\r\n      copy.deadZone = 0.5;\r\n    }\r\n  } else {\r\n    console.warn(\"unknown mapping type\", copy.type);\r\n    return emptyMapping();\r\n  }\r\n  return copy;\r\n};\r\nconst prepareMappingForExport = (mapping) => Object.assign({}, mapping);\r\nconst prepareAxisMappingForExport = prepareMappingForExport;\r\nconst prepareButtonMappingForExport = (mapping) => {\r\n  const copy = prepareMappingForExport(mapping);\r\n  delete copy.deadZone;\r\n  delete copy.low;\r\n  return copy;\r\n};\r\n\r\nconst padWithEmptyMappings = (array, length) => {\r\n  // Keep adding empty mappings until the list is full\r\n  while (array.length < length) {\r\n    array.push(emptyMapping());\r\n  }\r\n  // In case the input array is longer than the desired length\r\n  array.length = length;\r\n  return array;\r\n};\r\n\r\nconst createEmptyMappingList = (length) => padWithEmptyMappings([], length);\r\n\r\nconst getMovementConfiguration = (usedKeys) => ({\r\n  usesArrows:\r\n    usedKeys.has(\"ArrowUp\") || usedKeys.has(\"ArrowDown\") || usedKeys.has(\"ArrowRight\") || usedKeys.has(\"ArrowLeft\"),\r\n  usesWASD: (usedKeys.has(\"w\") && usedKeys.has(\"s\")) || (usedKeys.has(\"a\") && usedKeys.has(\"d\")),\r\n});\r\n\r\nconst getGamepadId = (gamepad) => `${gamepad.id} (${gamepad.index})`;\r\n\r\nclass GamepadData {\r\n  /**\r\n   * @param {Gamepad} gamepad Source Gamepad\r\n   * @param {GamepadLib} gamepadLib Parent GamepadLib\r\n   */\r\n  constructor(gamepad, gamepadLib) {\r\n    this.gamepad = gamepad;\r\n    this.gamepadLib = gamepadLib;\r\n    this.resetMappings();\r\n  }\r\n\r\n  resetMappings() {\r\n    this.hints = this.gamepadLib.getHints();\r\n    this.buttonMappings = this.getDefaultButtonMappings().map(transformAndCopyMapping);\r\n    this.axesMappings = this.getDefaultAxisMappings().map(transformAndCopyMapping);\r\n  }\r\n\r\n  clearMappings() {\r\n    this.buttonMappings = createEmptyMappingList(this.gamepad.buttons.length);\r\n    this.axesMappings = createEmptyMappingList(this.gamepad.axes.length);\r\n  }\r\n\r\n  getDefaultButtonMappings() {\r\n    let buttons;\r\n    if (this.hints.importedSettings) {\r\n      buttons = this.hints.importedSettings.buttons;\r\n    } else {\r\n      const usedKeys = this.hints.usedKeys;\r\n      const alreadyUsedKeys = new Set();\r\n      const { usesArrows, usesWASD } = getMovementConfiguration(usedKeys);\r\n      if (usesWASD) {\r\n        alreadyUsedKeys.add(\"w\");\r\n        alreadyUsedKeys.add(\"a\");\r\n        alreadyUsedKeys.add(\"s\");\r\n        alreadyUsedKeys.add(\"d\");\r\n      }\r\n      const possiblePauseKeys = [\r\n        // Restart keys, pause keys, other potentially dangerous keys\r\n        \"p\",\r\n        \"q\",\r\n        \"r\",\r\n      ];\r\n      const possibleActionKeys = [\r\n        \" \",\r\n        \"Enter\",\r\n        \"e\",\r\n        \"f\",\r\n        \"z\",\r\n        \"x\",\r\n        \"c\",\r\n        ...Array.from(usedKeys).filter((i) => i.length === 1 && !possiblePauseKeys.includes(i)),\r\n      ];\r\n\r\n      const findKey = (keys) => {\r\n        for (const key of keys) {\r\n          if (usedKeys.has(key) && !alreadyUsedKeys.has(key)) {\r\n            alreadyUsedKeys.add(key);\r\n            return key;\r\n          }\r\n        }\r\n        return null;\r\n      };\r\n      const getPrimaryAction = () => {\r\n        if (usesArrows && usedKeys.has(\"ArrowUp\")) {\r\n          return \"ArrowUp\";\r\n        }\r\n        if (usesWASD && usedKeys.has(\"w\")) {\r\n          return \"w\";\r\n        }\r\n        return findKey(possibleActionKeys);\r\n      };\r\n      const getSecondaryAction = () => findKey(possibleActionKeys);\r\n      const getPauseKey = () => findKey(possiblePauseKeys);\r\n      const getUp = () => {\r\n        if (usesArrows || !usesWASD) return \"ArrowUp\";\r\n        return \"w\";\r\n      };\r\n      const getDown = () => {\r\n        if (usesArrows || !usesWASD) return \"ArrowDown\";\r\n        return \"s\";\r\n      };\r\n      const getRight = () => {\r\n        if (usesArrows || !usesWASD) return \"ArrowRight\";\r\n        return \"d\";\r\n      };\r\n      const getLeft = () => {\r\n        if (usesArrows || !usesWASD) return \"ArrowLeft\";\r\n        return \"a\";\r\n      };\r\n\r\n      const action1 = getPrimaryAction();\r\n      let action2 = getSecondaryAction();\r\n      let action3 = getSecondaryAction();\r\n      let action4 = getSecondaryAction();\r\n      // When only 1 or 2 action keys are detected, bind the other buttons to the same things.\r\n      if (action1 && !action2 && !action3 && !action4) {\r\n        action2 = action1;\r\n        action3 = action1;\r\n        action4 = action1;\r\n      }\r\n      if (action1 && action2 && !action3 && !action4) {\r\n        action3 = action1;\r\n        action4 = action2;\r\n      }\r\n\r\n      // Set indices \"manually\" because we don't evaluate them in order.\r\n      buttons = [];\r\n      buttons[0] = {\r\n        /*\r\n        Xbox: A\r\n        SNES-like: B\r\n        */\r\n        type: \"key\",\r\n        high: action1,\r\n      };\r\n      buttons[1] = {\r\n        /*\r\n        Xbox: B\r\n        SNES-like: A\r\n        */\r\n        type: \"key\",\r\n        high: action2,\r\n      };\r\n      buttons[2] = {\r\n        /*\r\n        Xbox: X\r\n        SNES-like: Y\r\n        */\r\n        type: \"key\",\r\n        high: action3,\r\n      };\r\n      buttons[3] = {\r\n        /*\r\n        Xbox: Y\r\n        SNES-like: X\r\n        */\r\n        type: \"key\",\r\n        high: action4,\r\n      };\r\n      buttons[4] = {\r\n        /*\r\n        Xbox: LB\r\n        SNES-like: Left trigger\r\n        */\r\n        type: \"mousedown\",\r\n      };\r\n      buttons[5] = {\r\n        /*\r\n        Xbox: RB\r\n        */\r\n        type: \"mousedown\",\r\n      };\r\n      buttons[6] = {\r\n        /*\r\n        Xbox: LT\r\n        */\r\n        type: \"mousedown\",\r\n      };\r\n      buttons[7] = {\r\n        /*\r\n        Xbox: RT\r\n        SNES-like: Right trigger\r\n        */\r\n        type: \"mousedown\",\r\n      };\r\n      buttons[9] = {\r\n        /*\r\n        Xbox: Menu\r\n        SNES-like: Start\r\n        */\r\n        type: \"key\",\r\n        high: getPauseKey(),\r\n      };\r\n      buttons[8] = {\r\n        /*\r\n        Xbox: Change view\r\n        SNES-like: Select\r\n        */\r\n        type: \"key\",\r\n        high: getPauseKey(),\r\n      };\r\n      // Xbox: Left analog press\r\n      buttons[10] = emptyMapping();\r\n      // Xbox: Right analog press\r\n      buttons[11] = emptyMapping();\r\n      buttons[12] = {\r\n        /*\r\n        Xbox: D-pad up\r\n        */\r\n        type: \"key\",\r\n        high: getUp(),\r\n      };\r\n      buttons[13] = {\r\n        /*\r\n        Xbox: D-pad down\r\n        */\r\n        type: \"key\",\r\n        high: getDown(),\r\n      };\r\n      buttons[14] = {\r\n        /*\r\n        Xbox: D-pad left\r\n        */\r\n        type: \"key\",\r\n        high: getLeft(),\r\n      };\r\n      buttons[15] = {\r\n        /*\r\n        Xbox: D-pad right\r\n        */\r\n        type: \"key\",\r\n        high: getRight(),\r\n      };\r\n    }\r\n    return padWithEmptyMappings(buttons, this.gamepad.buttons.length);\r\n  }\r\n\r\n  getDefaultAxisMappings() {\r\n    let axes = [];\r\n    if (this.hints.importedSettings) {\r\n      axes = this.hints.importedSettings.axes;\r\n    } else {\r\n      // Only return default axis mappings when there are 4 axes, like an xbox controller\r\n      // If there isn't exactly 4, we can't really predict what the axes mean\r\n      // Some controllers map the dpad to *both* buttons and axes at the same time, which would cause conflicts.\r\n      if (this.gamepad.axes.length === 4) {\r\n        const usedKeys = this.hints.usedKeys;\r\n        const { usesArrows, usesWASD } = getMovementConfiguration(usedKeys);\r\n        if (usesWASD) {\r\n          axes.push(defaultAxesMappings.wasd[0]);\r\n          axes.push(defaultAxesMappings.wasd[1]);\r\n        } else if (usesArrows) {\r\n          axes.push(defaultAxesMappings.arrows[0]);\r\n          axes.push(defaultAxesMappings.arrows[1]);\r\n        } else {\r\n          axes.push(defaultAxesMappings.cursor[0]);\r\n          axes.push(defaultAxesMappings.cursor[1]);\r\n        }\r\n        axes.push(defaultAxesMappings.cursor[0]);\r\n        axes.push(defaultAxesMappings.cursor[1]);\r\n      }\r\n    }\r\n    return padWithEmptyMappings(axes, this.gamepad.axes.length);\r\n  }\r\n}\r\n\r\nconst defaultHints = () => ({\r\n  usedKeys: new Set(),\r\n  importedSettings: null,\r\n  generated: false,\r\n});\r\n\r\nclass GamepadLib extends EventTarget {\r\n  constructor() {\r\n    super();\r\n\r\n    /** @type {Map<string, GamepadData>} */\r\n    this.gamepads = new Map();\r\n\r\n    this.handleConnect = this.handleConnect.bind(this);\r\n    this.handleDisconnect = this.handleDisconnect.bind(this);\r\n    this.update = this.update.bind(this);\r\n\r\n    this.animationFrame = null;\r\n    this.currentTime = null;\r\n    this.deltaTime = 0;\r\n\r\n    this.virtualCursor = {\r\n      x: 0,\r\n      y: 0,\r\n      maxX: Infinity,\r\n      minX: -Infinity,\r\n      maxY: Infinity,\r\n      minY: -Infinity,\r\n      modified: false,\r\n    };\r\n\r\n    this._editor = null;\r\n\r\n    this.connectCallbacks = [];\r\n\r\n    this.keysPressedThisFrame = new Set();\r\n    this.oldKeysPressed = new Set();\r\n\r\n    this.mouseButtonsPressedThisFrame = new Set();\r\n    this.oldMouseDown = new Set();\r\n\r\n    this.addEventHandlers();\r\n  }\r\n\r\n  addEventHandlers() {\r\n    window.addEventListener(\"gamepadconnected\", this.handleConnect);\r\n    window.addEventListener(\"gamepaddisconnected\", this.handleDisconnect);\r\n  }\r\n\r\n  removeEventHandlers() {\r\n    window.removeEventListener(\"gamepadconnected\", this.handleConnect);\r\n    window.removeEventListener(\"gamepaddisconnected\", this.handleDisconnect);\r\n  }\r\n\r\n  gamepadConnected() {\r\n    if (this.gamepads.size > 0) {\r\n      return Promise.resolve();\r\n    }\r\n    return new Promise((resolve) => {\r\n      this.connectCallbacks.push(resolve);\r\n    });\r\n  }\r\n\r\n  getHints() {\r\n    return Object.assign(defaultHints(), this.getUserHints());\r\n  }\r\n\r\n  getUserHints() {\r\n    // to be overridden by users\r\n    return {};\r\n  }\r\n\r\n  resetControls() {\r\n    for (const gamepad of this.gamepads.values()) {\r\n      gamepad.resetMappings();\r\n    }\r\n  }\r\n\r\n  clearControls() {\r\n    for (const gamepad of this.gamepads.values()) {\r\n      gamepad.clearMappings();\r\n    }\r\n  }\r\n\r\n  handleConnect(e) {\r\n    for (const callback of this.connectCallbacks) {\r\n      callback();\r\n    }\r\n    this.connectCallbacks = [];\r\n    const gamepad = e.gamepad;\r\n    const id = getGamepadId(gamepad);\r\n    console.log(\"connected\", gamepad);\r\n    const gamepadData = new GamepadData(gamepad, this);\r\n    this.gamepads.set(id, gamepadData);\r\n    if (this.animationFrame === null) {\r\n      this.animationFrame = requestAnimationFrame(this.update);\r\n    }\r\n    this.dispatchEvent(new CustomEvent(\"gamepadconnected\", { detail: gamepadData }));\r\n  }\r\n\r\n  handleDisconnect(e) {\r\n    const gamepad = e.gamepad;\r\n    const id = getGamepadId(gamepad);\r\n    console.log(\"disconnected\", gamepad);\r\n    const gamepadData = this.gamepads.get(id);\r\n    this.gamepads.delete(id);\r\n    this.dispatchEvent(new CustomEvent(\"gamepaddisconnected\", { detail: gamepadData }));\r\n    if (this.gamepads.size === 0) {\r\n      cancelAnimationFrame(this.animationFrame);\r\n      this.animationFrame = null;\r\n      this.currentTime = null;\r\n    }\r\n  }\r\n\r\n  dispatchKey(key, pressed) {\r\n    if (pressed) {\r\n      this.dispatchEvent(new CustomEvent(\"keydown\", { detail: key }));\r\n    } else {\r\n      this.dispatchEvent(new CustomEvent(\"keyup\", { detail: key }));\r\n    }\r\n  }\r\n\r\n  dispatchMouse(button, down) {\r\n    if (down) {\r\n      this.dispatchEvent(new CustomEvent(\"mousedown\", { detail: button }));\r\n    } else {\r\n      this.dispatchEvent(new CustomEvent(\"mouseup\", { detail: button }));\r\n    }\r\n  }\r\n\r\n  dispatchMouseMove(x, y) {\r\n    this.dispatchEvent(new CustomEvent(\"mousemove\", { detail: { x, y } }));\r\n  }\r\n\r\n  updateButton(value, mapping) {\r\n    if (mapping.type === \"key\") {\r\n      if (value >= mapping.deadZone) {\r\n        if (mapping.high) {\r\n          this.keysPressedThisFrame.add(mapping.high);\r\n        }\r\n      } else if (value <= -mapping.deadZone) {\r\n        if (mapping.low) {\r\n          this.keysPressedThisFrame.add(mapping.low);\r\n        }\r\n      }\r\n    } else if (mapping.type === \"mousedown\") {\r\n      const isDown = Math.abs(value) >= mapping.deadZone;\r\n      if (isDown) {\r\n        this.mouseButtonsPressedThisFrame.add(mapping.button);\r\n      }\r\n    } else if (mapping.type === \"virtual_cursor\") {\r\n      const deadZone = mapping.deadZone;\r\n      let action;\r\n      if (value >= deadZone) action = mapping.high;\r\n      if (value <= -deadZone) action = mapping.low;\r\n      if (action) {\r\n        // an axis value just beyond the deadzone should have a multiplier near 0, a high value should have a multiplier of 1\r\n        const multiplier = (Math.abs(value) - deadZone) / (1 - deadZone);\r\n        const speed = multiplier * multiplier * mapping.sensitivity * this.deltaTime;\r\n        if (action === \"+x\") {\r\n          this.virtualCursor.x += speed;\r\n        } else if (action === \"-x\") {\r\n          this.virtualCursor.x -= speed;\r\n        } else if (action === \"+y\") {\r\n          this.virtualCursor.y += speed;\r\n        } else if (action === \"-y\") {\r\n          this.virtualCursor.y -= speed;\r\n        }\r\n        this.virtualCursor.modified = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  update(time) {\r\n    this.oldKeysPressed = this.keysPressedThisFrame;\r\n    this.oldMouseButtonsPressed = this.mouseButtonsPressedThisFrame;\r\n    this.keysPressedThisFrame = new Set();\r\n    this.mouseButtonsPressedThisFrame = new Set();\r\n\r\n    if (this.currentTime === null) {\r\n      this.deltaTime = 0; // doesn't matter what this is, it's just the first frame\r\n    } else {\r\n      this.deltaTime = time - this.currentTime;\r\n    }\r\n    this.deltaTime = Math.max(Math.min(this.deltaTime, 1000), 0);\r\n    this.currentTime = time;\r\n\r\n    this.animationFrame = requestAnimationFrame(this.update);\r\n\r\n    const gamepads = navigator.getGamepads();\r\n    for (const gamepad of gamepads) {\r\n      if (gamepad === null) {\r\n        continue;\r\n      }\r\n\r\n      const id = getGamepadId(gamepad);\r\n      const data = this.gamepads.get(id);\r\n\r\n      for (let i = 0; i < gamepad.buttons.length; i++) {\r\n        const button = gamepad.buttons[i];\r\n        const value = button.value;\r\n        const mapping = data.buttonMappings[i];\r\n        this.updateButton(value, mapping);\r\n      }\r\n\r\n      for (let i = 0; i < gamepad.axes.length; i++) {\r\n        const axis = gamepad.axes[i];\r\n        const mapping = data.axesMappings[i];\r\n        this.updateButton(axis, mapping);\r\n      }\r\n    }\r\n\r\n    if (this._editor) {\r\n      this._editor.update(gamepads);\r\n    }\r\n\r\n    for (const key of this.keysPressedThisFrame) {\r\n      if (!this.oldKeysPressed.has(key)) {\r\n        this.dispatchKey(key, true);\r\n      }\r\n    }\r\n    for (const key of this.oldKeysPressed) {\r\n      if (!this.keysPressedThisFrame.has(key)) {\r\n        this.dispatchKey(key, false);\r\n      }\r\n    }\r\n\r\n    for (const button of this.mouseButtonsPressedThisFrame) {\r\n      if (!this.oldMouseButtonsPressed.has(button)) {\r\n        this.dispatchMouse(button, true);\r\n      }\r\n    }\r\n    for (const button of this.oldMouseButtonsPressed) {\r\n      if (!this.mouseButtonsPressedThisFrame.has(button)) {\r\n        this.dispatchMouse(button, false);\r\n      }\r\n    }\r\n\r\n    if (this.virtualCursor.modified) {\r\n      this.virtualCursor.modified = false;\r\n      if (this.virtualCursor.x > this.virtualCursor.maxX) {\r\n        this.virtualCursor.x = this.virtualCursor.maxX;\r\n      }\r\n      if (this.virtualCursor.x < this.virtualCursor.minX) {\r\n        this.virtualCursor.x = this.virtualCursor.minX;\r\n      }\r\n      if (this.virtualCursor.y > this.virtualCursor.maxY) {\r\n        this.virtualCursor.y = this.virtualCursor.maxY;\r\n      }\r\n      if (this.virtualCursor.y < this.virtualCursor.minY) {\r\n        this.virtualCursor.y = this.virtualCursor.minY;\r\n      }\r\n      this.dispatchMouseMove(this.virtualCursor.x, this.virtualCursor.y);\r\n    }\r\n  }\r\n}\r\n\r\nGamepadLib.browserHasBrokenGamepadAPI = () => {\r\n  // Check that the gamepad API is supported at all\r\n  if (!navigator.getGamepads) {\r\n    return true;\r\n  }\r\n  // Firefox on Linux has a broken gamepad API implementation that results in strange and sometimes unusable mappings\r\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1643358\r\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1643835\r\n  if (navigator.userAgent.includes(\"Firefox\") && navigator.userAgent.includes(\"Linux\")) {\r\n    return true;\r\n  }\r\n  // Firefox on macOS has other bugs that result in strange and unusable mappings\r\n  // eg. https://bugzilla.mozilla.org/show_bug.cgi?id=1434408\r\n  if (navigator.userAgent.includes(\"Firefox\") && navigator.userAgent.includes(\"Mac OS\")) {\r\n    return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nGamepadLib.setConsole = (n) => (console = n);\r\n\r\nexport default GamepadLib;\r\n","import gamepadUserscript from './userscript.js';\r\nimport gamepadUserstyle from '!raw-loader!./style.css'\r\n\r\nconst addStylesheet = (css) => {\r\n  const stylesheet = document.createElement('style');\r\n  stylesheet.textContent = css;\r\n  document.head.appendChild(stylesheet);\r\n};\r\n\r\nconst run = ({ scaffolding, options }) => {\r\n  gamepadUserscript(scaffolding, options.pointerlock);\r\n  addStylesheet(gamepadUserstyle);\r\n};\r\n\r\nexport default run;\r\n","/* inserted by pull.js */\nimport _sidekickAsset0 from \"./active.png\";\nimport _sidekickAsset1 from \"./close.svg\";\nimport _sidekickAsset2 from \"./cursor.png\";\nimport _sidekickAsset3 from \"./dot.svg\";\nconst _sidekickGetAsset = (path) => {\n  if (path === \"/active.png\") return _sidekickAsset0;\n  if (path === \"/close.svg\") return _sidekickAsset1;\n  if (path === \"/cursor.png\") return _sidekickAsset2;\n  if (path === \"/dot.svg\") return _sidekickAsset3;\n  throw new Error(`Unknown asset: ${path}`);\n};\n\nimport GamepadLib from \"./gamepadlib.js\";\n\nexport default async function (scaffolding, pointerlock) {\n  const vm = scaffolding.vm;\n\n  // Wait for the project to finish loading. Renderer and scripts will not be fully available until this happens.\n  await new Promise((resolve) => {\n    if (vm.editingTarget) return resolve();\n    vm.runtime.once(\"PROJECT_LOADED\", resolve);\n  });\n\n  const vmStarted = () => vm.runtime._steppingInterval !== null;\n\n  const scratchKeyToKey = (key) => {\n    switch (key) {\n      case \"right arrow\":\n        return \"ArrowRight\";\n      case \"up arrow\":\n        return \"ArrowUp\";\n      case \"left arrow\":\n        return \"ArrowLeft\";\n      case \"down arrow\":\n        return \"ArrowDown\";\n      case \"enter\":\n        return \"Enter\";\n      case \"space\":\n        return \" \";\n    }\n    return key.toLowerCase().charAt(0);\n  };\n  const getKeysUsedByProject = () => {\n    const allBlocks = [vm.runtime.getTargetForStage(), ...vm.runtime.targets]\n      .filter((i) => i.isOriginal)\n      .map((i) => i.blocks);\n    const result = new Set();\n    for (const blocks of allBlocks) {\n      for (const block of Object.values(blocks._blocks)) {\n        if (\n          block.opcode === \"event_whenkeypressed\" ||\n          block.opcode === \"sensing_keyoptions\"\n        ) {\n          // For blocks like \"key (my variable) pressed?\", the sensing_keyoptions still exists but has a null parent.\n          if (block.opcode === \"sensing_keyoptions\" && !block.parent) {\n            continue;\n          }\n          const key = block.fields.KEY_OPTION.value;\n          result.add(scratchKeyToKey(key));\n        }\n      }\n    }\n    return result;\n  };\n\n  const GAMEPAD_CONFIG_MAGIC = \" // _gamepad_\";\n  const findOptionsComment = () => {\n    const target = vm.runtime.getTargetForStage();\n    const comments = target.comments;\n    for (const comment of Object.values(comments)) {\n      if (comment.text.includes(GAMEPAD_CONFIG_MAGIC)) {\n        return comment;\n      }\n    }\n    return null;\n  };\n  const parseOptionsComment = () => {\n    const comment = findOptionsComment();\n    if (!comment) {\n      return null;\n    }\n    const lineWithMagic = comment.text\n      .split(\"\\n\")\n      .find((i) => i.endsWith(GAMEPAD_CONFIG_MAGIC));\n    if (!lineWithMagic) {\n      console.warn(\"Gamepad comment does not contain valid line\");\n      return null;\n    }\n    const jsonText = lineWithMagic.substr(\n      0,\n      lineWithMagic.length - GAMEPAD_CONFIG_MAGIC.length\n    );\n    let parsed;\n    try {\n      parsed = JSON.parse(jsonText);\n      if (\n        !parsed ||\n        typeof parsed !== \"object\" ||\n        !Array.isArray(parsed.buttons) ||\n        !Array.isArray(parsed.axes)\n      ) {\n        throw new Error(\"Invalid data\");\n      }\n    } catch (e) {\n      console.warn(\"Gamepad comment has invalid JSON\", e);\n      return null;\n    }\n    return parsed;\n  };\n\n  GamepadLib.setConsole(console);\n  const gamepad = new GamepadLib();\n\n  const parsedOptions = parseOptionsComment();\n  gamepad.getUserHints = () => {\n    if (parsedOptions) {\n      return {\n        importedSettings: parsedOptions,\n      };\n    }\n    return {\n      usedKeys: getKeysUsedByProject(),\n    };\n  };\n\n  const renderer = vm.runtime.renderer;\n  const width = renderer._xRight - renderer._xLeft;\n  const height = renderer._yTop - renderer._yBottom;\n  const canvas = renderer.canvas;\n\n  const virtualCursorElement = document.createElement(\"img\");\n  virtualCursorElement.hidden = true;\n  virtualCursorElement.className = \"sa-gamepad-cursor\";\n  virtualCursorElement.src = _sidekickGetAsset(\"/cursor.png\");\n\n  let hideCursorTimeout;\n\n  const hideRealCursor = () => {\n    document.body.classList.add(\"sa-gamepad-hide-cursor\");\n  };\n  const showRealCursor = () => {\n    document.body.classList.remove(\"sa-gamepad-hide-cursor\");\n  };\n  const virtualCursorSetVisible = (visible) => {\n    virtualCursorElement.hidden = !visible;\n    clearTimeout(hideCursorTimeout);\n    if (visible) {\n      hideRealCursor();\n      hideCursorTimeout = setTimeout(virtualCursorHide, 8000);\n    }\n  };\n  const virtualCursorHide = () => {\n    virtualCursorSetVisible(false);\n  };\n  const virtualCursorSetDown = (down) => {\n    virtualCursorSetVisible(true);\n    virtualCursorElement.classList.toggle(\"sa-gamepad-cursor-down\", down);\n  };\n  const virtualCursorSetPosition = (x, y) => {\n    virtualCursorSetVisible(true);\n    const CURSOR_SIZE = 6;\n    const stageX = width / 2 + x - CURSOR_SIZE / 2;\n    const stageY = height / 2 - y - CURSOR_SIZE / 2;\n    virtualCursorElement.style.transform = `translate(${stageX}px, ${stageY}px)`;\n  };\n\n  document.addEventListener(\"mousemove\", () => {\n    virtualCursorSetVisible(false);\n    showRealCursor();\n  });\n\n  let getCanvasSize;\n  // Support modern ResizeObserver and slow getBoundingClientRect version for improved browser support (matters for Sidekick).\n  if (window.ResizeObserver) {\n    let canvasWidth = width;\n    let canvasHeight = height;\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        canvasWidth = entry.contentRect.width;\n        canvasHeight = entry.contentRect.height;\n      }\n    });\n    resizeObserver.observe(canvas);\n    getCanvasSize = () => [canvasWidth, canvasHeight];\n  } else {\n    getCanvasSize = () => {\n      const rect = canvas.getBoundingClientRect();\n      return [rect.width, rect.height];\n    };\n  }\n\n  // Both in Scratch space\n  let virtualX = 0;\n  let virtualY = 0;\n  const postMouseData = (data) => {\n    if (!vmStarted()) return;\n    const [rectWidth, rectHeight] = getCanvasSize();\n    vm.postIOData(\"mouse\", {\n      ...data,\n      canvasWidth: rectWidth,\n      canvasHeight: rectHeight,\n      x: (virtualX + width / 2) * (rectWidth / width),\n      y: (height / 2 - virtualY) * (rectHeight / height),\n    });\n  };\n  const postKeyboardData = (key, isDown) => {\n    if (!vmStarted()) return;\n    vm.postIOData(\"keyboard\", {\n      key,\n      isDown,\n    });\n  };\n  const handleGamepadButtonDown = (e) => postKeyboardData(e.detail, true);\n  const handleGamepadButtonUp = (e) => postKeyboardData(e.detail, false);\n  const handleGamepadMouseDown = (e) => {\n    virtualCursorSetDown(true);\n    postMouseData({\n      isDown: true,\n      button: e.detail,\n    });\n  };\n  const handleGamepadMouseUp = (e) => {\n    virtualCursorSetDown(false);\n    postMouseData({\n      isDown: false,\n      button: e.detail,\n    });\n  };\n  const handleGamepadMouseMove = (e) => {\n    const { x, y } = e.detail;\n    if (pointerlock) {\n      const deltaX = x - virtualX;\n      const deltaY = -(y - virtualY);\n      virtualX = x;\n      virtualY = y;\n      // Coordinates that pointerlock accepts are in \"screen space\" but virtual cursor is in \"stage space\"\n      const SPEED_MULTIPLIER = 4.0;\n      const zoomMultiplierX =\n        scaffolding.layersRect.width / vm.runtime.stageWidth;\n      const zoomMultiplierY =\n        scaffolding.layersRect.height / vm.runtime.stageHeight;\n      // This is defined in pointerlock addon\n      vm.pointerLockMove(\n        deltaX * SPEED_MULTIPLIER * zoomMultiplierX,\n        deltaY * SPEED_MULTIPLIER * zoomMultiplierY\n      );\n    } else {\n      virtualX = x;\n      virtualY = y;\n      virtualCursorSetPosition(virtualX, virtualY);\n      postMouseData({});\n    }\n  };\n\n  if (!pointerlock) {\n    gamepad.virtualCursor.maxX = renderer._xRight;\n    gamepad.virtualCursor.minX = renderer._xLeft;\n    gamepad.virtualCursor.maxY = renderer._yTop;\n    gamepad.virtualCursor.minY = renderer._yBottom;\n  }\n\n  gamepad.addEventListener(\"keydown\", handleGamepadButtonDown);\n  gamepad.addEventListener(\"keyup\", handleGamepadButtonUp);\n  gamepad.addEventListener(\"mousedown\", handleGamepadMouseDown);\n  gamepad.addEventListener(\"mouseup\", handleGamepadMouseUp);\n  gamepad.addEventListener(\"mousemove\", handleGamepadMouseMove);\n\n  if (!pointerlock) {\n    scaffolding._overlays.appendChild(virtualCursorElement);\n  }\n}\n","import gamepad from './gamepad';\r\nimport pointerlock from './pointerlock';\r\nimport specialCloudBehaviors from './special-cloud-behaviors';\r\nimport unsafeCloudBehaviors from './unsafe-cloud-behaviors';\r\nimport pause from './pause';\r\n\r\nconst run = (scaffolding, options) => {\r\n  const api = {\r\n    scaffolding,\r\n    options\r\n  };\r\n\r\n  if (options.gamepad) gamepad(api);\r\n  if (options.pointerlock) pointerlock(api);\r\n  if (options.specialCloudBehaviors) specialCloudBehaviors(api);\r\n  if (options.unsafeCloudBehaviors) unsafeCloudBehaviors(api);\r\n  if (options.pause) pause(api);\r\n};\r\n\r\nwindow.ScaffoldingAddons = {\r\n  run\r\n};\r\n","export default function ({ scaffolding }) {\r\n  // This file is based on the `pause` addon from Scratch Addons\r\n  // All major portions of this file were written by me, so the GPL does not apply\r\n\r\n  const STATUS_PROMISE_WAIT = 1;\r\n  const STATUS_DONE = 4;\r\n\r\n  const vm = scaffolding.vm;\r\n\r\n  let paused = false;\r\n  let pausedThreadState = new WeakMap();\r\n\r\n  let audioContextStateChange = Promise.resolve();\r\n\r\n  const setPaused = (_paused) => {\r\n    paused = _paused;\r\n\r\n    if (paused) {\r\n      audioContextStateChange = audioContextStateChange.then(() => {\r\n        return vm.runtime.audioEngine.audioContext.suspend();\r\n      });\r\n      if (!vm.runtime.ioDevices.clock._paused) {\r\n        vm.runtime.ioDevices.clock.pause();\r\n      }\r\n\r\n      for (const thread of vm.runtime.threads) {\r\n        if (!thread.updateMonitor && !pausedThreadState.has(thread)) {\r\n          const pauseState = {\r\n            pauseTime: vm.runtime.currentMSecs,\r\n            status: thread.status,\r\n          };\r\n          pausedThreadState.set(thread, pauseState);\r\n          thread.status = STATUS_PROMISE_WAIT;\r\n        }\r\n      }\r\n\r\n      // Immediately emit project stop\r\n      // Scratch will do this automatically, but there may be a slight delay.\r\n      vm.runtime.emit(\"PROJECT_RUN_STOP\");\r\n    } else {\r\n      audioContextStateChange = audioContextStateChange.then(() => {\r\n        return vm.runtime.audioEngine.audioContext.resume();\r\n      });\r\n      vm.runtime.ioDevices.clock.resume();\r\n\r\n      const now = Date.now();\r\n      for (const thread of vm.runtime.threads) {\r\n        const pauseState = pausedThreadState.get(thread);\r\n        if (pauseState) {\r\n          const stackFrame = thread.peekStackFrame();\r\n          if (stackFrame && stackFrame.executionContext && stackFrame.executionContext.timer) {\r\n            const dt = now - pauseState.pauseTime;\r\n            stackFrame.executionContext.timer.startTime += dt;\r\n          }\r\n          // Compiler state is stored differently\r\n          if (thread.timer) {\r\n            const dt = now - pauseState.pauseTime;\r\n            thread.timer.startTime += dt;\r\n          }\r\n          thread.status = pauseState.status;\r\n        }\r\n      }\r\n      pausedThreadState = new WeakMap();\r\n    }\r\n\r\n    vm.emit('P4_PAUSE', paused);\r\n  };\r\n\r\n  const ensurePausedThreadIsStillPaused = (thread) => {\r\n    if (thread.status === STATUS_DONE) {\r\n      return;\r\n    }\r\n    const pauseState = pausedThreadState.get(thread);\r\n    if (pauseState) {\r\n      if (thread.status !== STATUS_PROMISE_WAIT) {\r\n        // We'll record the change so we can properly resume the thread, but the thread must still be paused for now.\r\n        pauseState.status = thread.status;\r\n        thread.status = STATUS_PROMISE_WAIT;\r\n      }\r\n    }\r\n  };\r\n\r\n  const originalStepThreads = vm.runtime.sequencer.stepThreads;\r\n  vm.runtime.sequencer.stepThreads = function () {\r\n    if (paused) {\r\n      for (const thread of this.runtime.threads) {\r\n        ensurePausedThreadIsStillPaused(thread);\r\n      }\r\n    }\r\n    return originalStepThreads.call(this);\r\n  };\r\n\r\n  const originalGreenFlag = vm.runtime.greenFlag;\r\n  vm.runtime.greenFlag = function () {\r\n    setPaused(false);\r\n    return originalGreenFlag.call(this);\r\n  };\r\n\r\n  // Disable edge-activated hats and hats like \"when key pressed\" while paused.\r\n  const originalStartHats = vm.runtime.startHats;\r\n  vm.runtime.startHats = function (...args) {\r\n    if (paused) {\r\n      return [];\r\n    }\r\n    return originalStartHats.apply(this, args);\r\n  };\r\n\r\n  // Paused threads should not be counted as running when updating GUI state.\r\n  const originalGetMonitorThreadCount = vm.runtime._getMonitorThreadCount;\r\n  vm.runtime._getMonitorThreadCount = function (threads) {\r\n    let count = originalGetMonitorThreadCount.call(this, threads);\r\n    if (paused) {\r\n      for (const thread of threads) {\r\n        if (pausedThreadState.has(thread)) {\r\n          count++;\r\n        }\r\n      }\r\n    }\r\n    return count;\r\n  };\r\n\r\n  vm.setPaused = setPaused;\r\n}","const run = ({ scaffolding }) => {\r\n  const canvas = scaffolding._canvas;\r\n  const vm = scaffolding.vm;\r\n  const mouse = vm.runtime.ioDevices.mouse;\r\n  let isLocked = false;\r\n\r\n  const postMouseData = (e, isDown) => {\r\n    const {movementX, movementY} = e;\r\n    const {width, height} = scaffolding.layersRect;\r\n    const x = mouse._clientX + movementX;\r\n    const y = mouse._clientY - movementY;\r\n    mouse._clientX = x;\r\n    mouse._scratchX = mouse.runtime.stageWidth * ((x / width) - 0.5);\r\n    mouse._clientY = y;\r\n    mouse._scratchY = mouse.runtime.stageWidth * ((y / height) - 0.5);\r\n    if (typeof isDown === 'boolean') {\r\n      const data = {\r\n        button: e.button,\r\n        isDown\r\n      };\r\n      vm.postIOData('mouse', data);\r\n    }\r\n  };\r\n  document.addEventListener(\"mousedown\", (e) => {\r\n    if (canvas.contains(e.target)) {\r\n      e.stopPropagation();\r\n      if (isLocked) {\r\n        postMouseData(e, true);\r\n      } else {\r\n        canvas.requestPointerLock();\r\n      }\r\n    }\r\n  }, true);\r\n  document.addEventListener(\"mouseup\", (e) => {\r\n    e.stopPropagation();\r\n    if (isLocked) {\r\n      postMouseData(e, false);\r\n    } else if (canvas.contains(e.target)) {\r\n      canvas.requestPointerLock();\r\n    }\r\n  }, true);\r\n  document.addEventListener(\"mousemove\", (e) => {\r\n    e.stopPropagation();\r\n    if (isLocked) {\r\n      postMouseData(e);\r\n    }\r\n  }, true);\r\n\r\n  scaffolding.addEventListener('PROJECT_RUN_START', () => {\r\n    if (!isLocked) {\r\n      canvas.requestPointerLock();\r\n    }\r\n  });\r\n\r\n  document.addEventListener('pointerlockchange', () => {\r\n    isLocked = document.pointerLockElement === canvas;\r\n  });\r\n  document.addEventListener('pointerlockerror', (e) => {\r\n    console.error('Pointer lock error', e);\r\n  });\r\n\r\n  vm.pointerLockMove = (deltaX, deltaY) => {\r\n    postMouseData({\r\n      // Essentially constructing a fake MouseEvent\r\n      movementX: deltaX,\r\n      movementY: deltaY\r\n    });\r\n  };\r\n\r\n  const oldStep = vm.runtime._step;\r\n  vm.runtime._step = function (...args) {\r\n    const ret = oldStep.call(this, ...args);\r\n    const {width, height} = scaffolding.layersRect;\r\n    mouse._clientX = width / 2;\r\n    mouse._clientY = height / 2;\r\n    mouse._scratchX = 0;\r\n    mouse._scratchY = 0;\r\n    return ret;\r\n  };\r\n};\r\n\r\nexport default run;\r\n","const SAFE_PROTOCOLS = [\r\n  // The only protocol that's critical to block is javascript:\r\n  // file: is indeed unsafe in places like Electron, but it's the Electron environment's job to protect against that\r\n  // Navigating between file: is safe on the web\r\n  'http:',\r\n  'https:',\r\n  'data:',\r\n  'file:',\r\n  'mailto:',\r\n];\r\n\r\nconst isSafeURL = (url) => {\r\n  try {\r\n    const u = new URL(url, location.href);\r\n    return SAFE_PROTOCOLS.includes(u.protocol);\r\n  } catch (e) {\r\n    return false;\r\n  }\r\n};\r\n\r\nconst shouldAlwaysOpenInNewTab = (url) => {\r\n  try {\r\n    const u = new URL(url, location.href);\r\n    // Browsers don't allow opening new tabs with data: URIs\r\n    return u.protocol === 'data:';\r\n  } catch (e) {\r\n    return false;\r\n  }\r\n};\r\n\r\nconst shouldAlwaysOpenInCurrentTab = (url) => {\r\n  try {\r\n    const u = new URL(url, location.href);\r\n    // If you open a mailto: in a new tab, the browser will convert it to about:blank and just leave an empty tab\r\n    return u.protocol === 'mailto:';\r\n  } catch (e) {\r\n    return false;\r\n  }\r\n};\r\n\r\nconst openInNewTab = (url) => {\r\n  window.open(url);\r\n};\r\n\r\nconst openInCurrentTab = (url) => {\r\n  location.href = url;\r\n};\r\n\r\nclass SpecialCloudBehaviorsProvider {\r\n  enable () {\r\n    this.manager.setVariable(this, '☁ url', location.href);\r\n\r\n    document.addEventListener('paste', (e) => {\r\n      const text = (e.clipboardData || window.clipboardData).getData('text');\r\n      this.manager.setVariable(this, '☁ pasted', text);\r\n    });\r\n\r\n    this.webSocketProvider = this.manager.providers.find(i => typeof i.setProjectId === 'function');\r\n    this.initialProjectId = this.webSocketProvider ? this.webSocketProvider.projectId : null;\r\n  }\r\n\r\n  handleUpdateVariable (name, value) {\r\n    if (name === '☁ redirect') {\r\n      if (isSafeURL(value)) {\r\n        if (shouldAlwaysOpenInNewTab(value)) {\r\n          openInNewTab(value);\r\n        } else {\r\n          openInCurrentTab(value);\r\n        }\r\n      }\r\n    } else if (name === '☁ open link') {\r\n      if (isSafeURL(value)) {\r\n        if (shouldAlwaysOpenInCurrentTab(value)) {\r\n          openInCurrentTab(value);\r\n        } else {\r\n          openInNewTab(value);\r\n        }\r\n      }\r\n    } else if (name === '☁ username') {\r\n      this.manager.parent.setUsername(value);\r\n    } else if (name === '☁ set clipboard') {\r\n      navigator.clipboard.writeText(value);\r\n    } else if (name === '☁ room id') {\r\n      if (this.webSocketProvider) {\r\n        const newId = this.initialProjectId + (value ? `-${value}` : '');\r\n        this.webSocketProvider.setProjectId(newId);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default function ({ scaffolding }) {\r\n  const provider = new SpecialCloudBehaviorsProvider();\r\n  scaffolding.addCloudProvider(provider);\r\n  scaffolding.addCloudProviderOverride('☁ url', provider);\r\n  scaffolding.addCloudProviderOverride('☁ redirect', provider);\r\n  scaffolding.addCloudProviderOverride('☁ open link', provider);\r\n  scaffolding.addCloudProviderOverride('☁ username', provider);\r\n  scaffolding.addCloudProviderOverride('☁ set clipboard', provider);\r\n  scaffolding.addCloudProviderOverride('☁ pasted', provider);\r\n  scaffolding.addCloudProviderOverride('☁ room id', provider);\r\n}\r\n","const isPromise = (v) => !!v && typeof v.then === 'function';\r\n\r\nconst jsValueToScratchValue = (v) => {\r\n  if (typeof v === 'boolean' || typeof v === 'number' || typeof v === 'string') {\r\n    return v;\r\n  }\r\n  return '' + v;\r\n};\r\n\r\nclass UnsafeCloudBehaviorsProvider {\r\n  enable () {\r\n\r\n  }\r\n\r\n  setEvalValue (value) {\r\n    this.manager.setVariable(this, '☁ eval output', jsValueToScratchValue(value));\r\n  }\r\n\r\n  setEvalError (error) {\r\n    console.error('Error evaluating ☁ eval', error);\r\n    this.manager.setVariable(this, '☁ eval error', jsValueToScratchValue(error));\r\n  }\r\n\r\n  evaluateAsync (js) {\r\n    try {\r\n      const value = eval(js);\r\n      if (isPromise(value)) {\r\n        value\r\n          .then((v) => this.setEvalValue(v))\r\n          .catch((e) => this.setEvalError(e));\r\n      } else {\r\n        this.setEvalValue(value)\r\n      }\r\n    } catch (e) {\r\n      this.setEvalError(e);\r\n    }\r\n  }\r\n\r\n  handleUpdateVariable (name, value) {\r\n    if (name === '☁ eval') {\r\n      this.evaluateAsync(value);\r\n    }\r\n  }\r\n}\r\n\r\nexport default function ({ scaffolding }) {\r\n  const provider = new UnsafeCloudBehaviorsProvider();\r\n  scaffolding.addCloudProvider(provider);\r\n  scaffolding.addCloudProviderOverride('☁ eval', provider);\r\n  scaffolding.addCloudProviderOverride('☁ eval output', provider);\r\n  scaffolding.addCloudProviderOverride('☁ eval error', provider);\r\n}\r\n","// Browser support for EventTarget constructor is surprisingly poor, so we always polyfill it\r\n// We also need to polyfill CustomEvent for Node.js\r\n\r\nclass EventTargetShim {\r\n  constructor () {\r\n    this._events = {};\r\n  }\r\n\r\n  addEventListener (event, handler) {\r\n    if (!this._events[event]) {\r\n      this._events[event] = [];\r\n    }\r\n    this._events[event].push(handler);\r\n  }\r\n\r\n  removeEventListener (event, handler) {\r\n    const handlers = this._events[event];\r\n    if (handlers) {\r\n      this._events[event] = handlers.filter(i => i !== handler);\r\n    }\r\n  }\r\n\r\n  dispatchEvent (event) {\r\n    const handlers = this._events[event.type];\r\n    if (handlers) {\r\n      for (const fn of handlers) {\r\n        fn(event);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nclass CustomEventShim {\r\n  constructor (type, options) {\r\n    this.type = type;\r\n    this.detail = options ? options.detail : {};\r\n  }\r\n}\r\n\r\nexport {\r\n  EventTargetShim as EventTarget,\r\n  CustomEventShim as CustomEvent\r\n};\r\n"],"sourceRoot":""}